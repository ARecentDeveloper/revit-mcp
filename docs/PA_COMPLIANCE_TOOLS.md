# PA Compliance Tools

The PA Compliance Tools provide comprehensive support for Port Authority of New York and New Jersey (PA) compliance management in Revit projects. These tools help identify, report, and fix naming convention and model integrity issues through an Excel-based workflow.

## Overview

The PA compliance system consists of two main tools:

1. **pa_compliance_report** - Generates comprehensive compliance reports
2. **pa_compliance_action** - Executes corrections based on reviewed Excel files

## Tool: pa_compliance_report

### Description
Generates a comprehensive PA compliance report that exports to Excel. This tool analyzes Revit projects for naming convention and model integrity issues, creating an Excel file with multiple sheets covering annotation families, model families, worksets, sheets, and model integrity. Each sheet includes current names and AI-suggested corrections following PA naming conventions.

### Parameters

| Parameter | Type | Default | Description |
|-----------|------|---------|-------------|
| `outputPath` | string | optional | Full path where the Excel compliance report should be saved. If not specified, saves to Documents folder with timestamp |
| `step` | enum | "all" | Execution step: "families", "worksets", "sheets", "integrity", or "all" |
| `includeAnnotationFamilies` | boolean | true | Include annotation family naming analysis |
| `includeModelFamilies` | boolean | true | Include model family naming analysis |
| `includeWorksets` | boolean | true | Include workset naming analysis |
| `includeSheets` | boolean | true | Include sheet naming analysis |
| `includeModelIntegrity` | boolean | true | Include model integrity analysis |

### Usage Examples

#### Generate Complete Compliance Report
```json
{
  "outputPath": "C:\\Reports\\PA_Compliance_Report.xlsx"
}
```

#### Generate Family Names Only
```json
{
  "step": "families",
  "includeAnnotationFamilies": true,
  "includeModelFamilies": true,
  "includeWorksets": false,
  "includeSheets": false,
  "includeModelIntegrity": false
}
```

#### Step-by-Step Execution
```json
{
  "step": "worksets",
  "outputPath": "C:\\Reports\\PA_Worksets_Report.xlsx"
}
```

### Output Structure

The generated Excel file contains multiple sheets:

#### Annotation Families Sheet
- **Category**: Element category
- **Current Name**: Current family name
- **Suggested Name**: PA-CATEGORY-DESCRIPTION format
- **User Correction**: Column for user modifications
- **Status**: Processing status

#### Model Families Sheet
- **Category**: Element category
- **Manufacturer**: Detected or "Generic"
- **Current Name**: Current family name
- **Suggested Name**: CATEGORY-MANUFACTURER-DESCRIPTION format
- **User Correction**: Column for user modifications
- **Status**: Processing status

#### Worksets Sheet
- **Current Name**: Current workset name
- **Suggested Name**: PA naming convention suggestion
- **User Correction**: Column for user modifications
- **Status**: Processing status

#### Sheets Sheet
- **Current Name**: Current sheet name
- **Suggested Name**: PA naming convention suggestion
- **User Correction**: Column for user modifications
- **Status**: Processing status

#### Model Integrity Sheet
- **Element ID**: Revit element ID
- **Current Category**: Current element category
- **Suggested Category**: Recommended category
- **User Correction**: Column for user modifications
- **Status**: Processing status

## Tool: pa_compliance_action

### Description
Executes PA compliance corrections based on a reviewed Excel file generated by the pa_compliance_report tool. This tool reads the Excel file, processes user-modified suggested names, and performs automated corrections including family renaming, workset renaming, sheet renaming, and element recategorization.

### Parameters

| Parameter | Type | Default | Description |
|-----------|------|---------|-------------|
| `excelFilePath` | string | required | Full path to Excel file with corrections |
| `step` | enum | "all" | Execution step: "families", "worksets", "sheets", "integrity", or "all" |
| `dryRun` | boolean | false | Preview changes without applying them |
| `backupProject` | boolean | true | Create project backup before changes |
| `continueOnError` | boolean | true | Continue processing if individual operations fail |
| `updateExcelStatus` | boolean | true | Update Excel file with operation results |

### Usage Examples

#### Execute All Corrections
```json
{
  "excelFilePath": "C:\\Reports\\PA_Compliance_Report.xlsx"
}
```

#### Dry Run Preview
```json
{
  "excelFilePath": "C:\\Reports\\PA_Compliance_Report.xlsx",
  "dryRun": true
}
```

#### Process Families Only
```json
{
  "excelFilePath": "C:\\Reports\\PA_Compliance_Report.xlsx",
  "step": "families",
  "backupProject": true
}
```

#### Execute Without Backup
```json
{
  "excelFilePath": "C:\\Reports\\PA_Compliance_Report.xlsx",
  "backupProject": false,
  "continueOnError": true
}
```

## Workflow

### Complete PA Compliance Workflow

1. **Generate Report**
   ```json
   {
     "tool": "pa_compliance_report",
     "parameters": {
       "outputPath": "C:\\Reports\\PA_Compliance_Report.xlsx"
     }
   }
   ```

2. **Review Excel File**
   - Open the generated Excel file
   - Review AI-suggested corrections
   - Modify suggestions in "User Correction" columns as needed
   - Save the Excel file

3. **Execute Corrections**
   ```json
   {
     "tool": "pa_compliance_action",
     "parameters": {
       "excelFilePath": "C:\\Reports\\PA_Compliance_Report.xlsx",
       "dryRun": true
     }
   }
   ```

4. **Apply Changes**
   ```json
   {
     "tool": "pa_compliance_action",
     "parameters": {
       "excelFilePath": "C:\\Reports\\PA_Compliance_Report.xlsx",
       "dryRun": false
     }
   }
   ```

### Step-by-Step Workflow

For large projects, process compliance areas incrementally:

1. **Process Families**
   ```json
   {
     "tool": "pa_compliance_report",
     "parameters": {
       "step": "families",
       "outputPath": "C:\\Reports\\PA_Families.xlsx"
     }
   }
   ```

2. **Apply Family Corrections**
   ```json
   {
     "tool": "pa_compliance_action",
     "parameters": {
       "excelFilePath": "C:\\Reports\\PA_Families.xlsx",
       "step": "families"
     }
   }
   ```

3. **Process Worksets**
   ```json
   {
     "tool": "pa_compliance_report",
     "parameters": {
       "step": "worksets",
       "outputPath": "C:\\Reports\\PA_Worksets.xlsx"
     }
   }
   ```

4. **Continue with remaining steps...**

## PA Naming Conventions

### Annotation Families
**Format**: `PA-CATEGORY-DESCRIPTION`

Examples:
- `PA-DOOR-STANDARD-SINGLE`
- `PA-WINDOW-CASEMENT-DOUBLE`
- `PA-FURNITURE-DESK-EXECUTIVE`

### Model Families
**Format**: `CATEGORY-MANUFACTURER-DESCRIPTION`

Examples:
- `DOOR-STEELCRAFT-HOLLOW-METAL`
- `WINDOW-ANDERSEN-CASEMENT-400`
- `FURNITURE-HERMAN-MILLER-AERON-CHAIR`

When manufacturer is unknown: `CATEGORY-Generic-DESCRIPTION`

### Worksets
Follow PA project-specific workset naming standards as defined in project BIM execution plans.

### Sheets
Follow PA sheet naming conventions including discipline codes and sequential numbering.

## Error Handling

### Common Issues and Solutions

#### Excel File Access
- **Issue**: "File is locked or in use"
- **Solution**: Close Excel file before running pa_compliance_action

#### Permission Errors
- **Issue**: "Cannot modify element"
- **Solution**: Check element permissions, ensure not locked by other users

#### Missing Elements
- **Issue**: "Element not found"
- **Solution**: Verify Excel file corresponds to current project state

#### Transaction Failures
- **Issue**: "Transaction failed"
- **Solution**: Use continueOnError=true to process remaining items

### Best Practices

1. **Always use dryRun first** to preview changes
2. **Create backups** before applying bulk changes
3. **Process incrementally** for large projects
4. **Review suggestions** before applying corrections
5. **Use continueOnError=true** for batch operations
6. **Update Excel status** to track progress

## Integration Notes

### Requirements
- Requires corresponding C# commands in revit-mcp-commandset
- Uses existing element filtering and parameter resolution systems
- Integrates with established MCP communication patterns

### Dependencies
- EPPlus or similar library for Excel operations
- Existing Revit API infrastructure
- Element modification services

### Performance Considerations
- Large projects may require step-by-step processing
- Excel operations are optimized for streaming
- Batch operations minimize Revit API calls
- Progress reporting for long-running operations